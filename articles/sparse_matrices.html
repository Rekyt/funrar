<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sparse Matrices within funrar • funrar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sparse Matrices within funrar">
<meta property="og:description" content="funrar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funrar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/funrar.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/new_distinctiveness.html">Alternative Distinctiveness definition</a>
    </li>
    <li>
      <a href="../articles/other_functions.html">Other functions of interest</a>
    </li>
    <li>
      <a href="../articles/sparse_matrices.html">Sparse Matrices within funrar</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rekyt/funrar/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sparse Matrices within funrar</h1>
                        <h4 data-toc-skip class="author">Matthias Grenié</h4>
            
            <h4 data-toc-skip class="date">2022-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Rekyt/funrar/blob/HEAD/vignettes/sparse_matrices.Rmd" class="external-link"><code>vignettes/sparse_matrices.Rmd</code></a></small>
      <div class="hidden name"><code>sparse_matrices.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="sparse-matrices-usefulness">Sparse Matrices Usefulness<a class="anchor" aria-label="anchor" href="#sparse-matrices-usefulness"></a>
</h2>
<p>When a matrix contains a lot of zero, there is no need to store all its values. But only the non-zero values, for example the following matrix:</p>
<p><span class="math display">\[\begin{equation}
  M =
    \bordermatrix{
             ~      &amp; \text{sp. A} &amp; \text{sp. B} &amp; {sp. C} \cr
      \text{site 1} &amp; 1 &amp; 0 &amp; 0 \cr
      \text{site 2} &amp; 0 &amp; 1 &amp; 1 \cr
      \text{site 3} &amp; 0 &amp; 1 &amp; 0 \cr}
\end{equation}\]</span></p>
<p>can be stored using only a matrix with non zero-values <span class="math inline">\(S\)</span>, with row index <span class="math inline">\(i\)</span> and column index <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[\begin{equation}
  S =
    \begin{matrix}
            i       &amp;       j       &amp; \text{value} \\
      \text{site 1} &amp; \text{sp. A} &amp; 1 \\
      \text{site 2} &amp; \text{sp. B} &amp; 1 \\
      \text{site 3} &amp; \text{sp. B} &amp; 1 \\
      \text{site 2} &amp; \text{sp. C} &amp; 1
    \end{matrix}
\end{equation}\]</span></p>
<p>If your site-species matrix is big, it may contain a lot zero because it is very unlikely that all species are present at all sites when looking at thousands of species and hundreds of sites. Thus, the sparse matrix notation would save a good amount of lines (look how <span class="math inline">\(S\)</span> compared to <span class="math inline">\(M\)</span>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a matrix with 1000 species and 200 sites</span></span>
<span><span class="va">my_mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="fl">200000</span><span class="op">)</span>,</span>
<span>                ncol <span class="op">=</span> <span class="fl">1000</span>, nrow <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_mat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##       sp1 sp2 sp3 sp4 sp5</span></span>
<span><span class="co">## site1   0   1   0   0   0</span></span>
<span><span class="co">## site2   0   0   0   0   0</span></span>
<span><span class="co">## site3   0   0   1   0   0</span></span>
<span><span class="co">## site4   0   1   1   0   0</span></span>
<span><span class="co">## site5   0   0   0   0   0</span></span></code></pre>
<p><code>funrar</code> lets you use sparse matrices directly using a function implemented in the <code>Matrix</code> package. When your matrix is filled with 0s it can be quicker to use sparse matrices. To know if you should use sparse matrices you can compute the filling of your matrix, i.e. the percentage of non-zero cells in your matrix:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filling</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">my_mat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filling</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.143205</span></span></code></pre>
<p>To convert from a normal matrix to a sparse matrix you can use <code>as(my_mat, "dgCMatrix")</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org/" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sparse_mat</span> <span class="op">=</span> <span class="fu">as</span><span class="op">(</span><span class="va">my_mat</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is</span><span class="op">(</span><span class="va">my_mat</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">is</span><span class="op">(</span><span class="va">sparse_mat</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>it completely changes the structure as well as the memory it takes in the RAM:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regular Matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  num [1:200, 1:1000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:200] "site1" "site2" "site3" "site4" ...</span></span>
<span><span class="co">##   ..$ : chr [1:1000] "sp1" "sp2" "sp3" "sp4" ...</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"Kb"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 1638 Kb</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sparse Matrix from 'Matrix' package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sparse_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:28641] 14 32 36 49 53 55 70 72 73 101 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:1001] 0 25 54 90 118 142 173 199 230 260 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 200 1000</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:200] "site1" "site2" "site3" "site4" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:1000] "sp1" "sp2" "sp3" "sp4" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:28641] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sparse_mat</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"Kb"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 416.1 Kb</span></span></code></pre>
<p>sparse matrices reduce the amount of RAM necessary to store them. The more zeros there are in a given matrix the more RAM will be spared when turning it into a sparse matrix.</p>
<div class="section level3">
<h3 id="benchmark">Benchmark<a class="anchor" aria-label="anchor" href="#benchmark"></a>
</h3>
<p>We can now compare the performances of the algorithms in rarity indices computation between a sparse matrix and a regular one, using the popular <a href="https://cran.r-project.org/package=microbenchmark" class="external-link"><code>microbenchmark</code></a> R package:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rekyt.github.io/funrar/" class="external-link">funrar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a table of traits</span></span>
<span><span class="va">trait_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">trait_df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute distance matrix</span></span>
<span><span class="va">dist_mat</span> <span class="op">=</span> <span class="fu"><a href="../reference/compute_dist_matrix.html">compute_dist_matrix</a></span><span class="op">(</span><span class="va">trait_df</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"microbenchmark"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>    regular <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">my_mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">sparse_mat</span>, <span class="va">dist_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="systematic-benchmark">Systematic benchmark<a class="anchor" aria-label="anchor" href="#systematic-benchmark"></a>
</h4>
<p>We generate matrices with different filling rate and compare the speed of regular matrix and sparse matrices computation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_matrix</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_zero</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">nrow</span> <span class="op">=</span> <span class="fl">200</span>, <span class="va">ncol</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_zero</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="va">nrow</span><span class="op">*</span><span class="va">ncol</span><span class="op">)</span>,</span>
<span>                ncol <span class="op">=</span> <span class="va">ncol</span>, nrow <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mat_filling</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">my_mat</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sparse_and_mat</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_zero</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">my_mat</span> <span class="op">=</span> <span class="fu">generate_matrix</span><span class="op">(</span><span class="va">n_zero</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">sparse_mat</span> <span class="op">=</span> <span class="fu">as</span><span class="op">(</span><span class="va">my_mat</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">my_mat</span>, sparse <span class="op">=</span> <span class="va">sparse_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n_zero_vector</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">49</span>, <span class="fl">99</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">n_zero_vector</span><span class="op">)</span> <span class="op">=</span> <span class="va">n_zero_vector</span></span>
<span></span>
<span><span class="va">all_mats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n_zero_vector</span>, <span class="va">sparse_and_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mat_filling</span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`0`</span><span class="op">$</span><span class="va">mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mat_filling</span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`99`</span><span class="op">$</span><span class="va">mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.009795</span></span></code></pre>
<p>Now we can compare the speed of the algorithms:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"microbenchmark"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mat_bench</span> <span class="op">=</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>    mat_0 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`0`</span><span class="op">$</span><span class="va">mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse_0 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`0`</span><span class="op">$</span><span class="va">sparse</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    mat_1 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse_1 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`1`</span><span class="op">$</span><span class="va">sparse</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    mat_2 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`2`</span><span class="op">$</span><span class="va">mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse_2 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`2`</span><span class="op">$</span><span class="va">sparse</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    mat_49 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`49`</span><span class="op">$</span><span class="va">mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse_49 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`49`</span><span class="op">$</span><span class="va">sparse</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    mat_99 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`99`</span><span class="op">$</span><span class="va">mat</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    sparse_99 <span class="op">=</span> <span class="fu"><a href="../reference/distinctiveness.html">distinctiveness</a></span><span class="op">(</span><span class="va">all_mats</span><span class="op">$</span><span class="va">`99`</span><span class="op">$</span><span class="va">sparse</span>, <span class="va">dist_mat</span><span class="op">)</span>,</span>
<span>    times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">mat_bench</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matthias Grenié, Pierre Denelle, Caroline Tucker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
